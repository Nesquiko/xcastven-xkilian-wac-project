openapi: 3.0.4
info:
  title: MediCal API
  version: 1.0.0
  description: |
    API for the MediCal application, managing patient appointment scheduling with doctors and access to patient medical history.
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
tags:
  - name: Appointments
    description: Manage appointment lifecycle (request, view, confirm, cancel, reschedule).
  - name: Doctors
    description: Retrieve doctor details and available timeslots.
  - name: Patients
    description: Manage patient information and access patient-specific data.
  - name: Medical History
    description: Retrieve patient medical history (diagnoses, appointments, prescriptions).
  - name: Resources
    description: Manage and view resources (facilities, equipment, medicine) for appointments.
paths:
  /patients:
    post:
      tags:
        - Patients
      summary: Register a new patient
      description: Creates a new patient record using email, first name, and last name.
      operationId: registerPatient
      requestBody:
        $ref: '#/components/requestBodies/PatientRegistration'
      responses:
        '201':
          $ref: '#/components/responses/PatientCreated'
        '400':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Bad Request - Invalid input data.
          content:
            application/problem+json:
              examples:
                validationError:
                  summary: Example validation error (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.invalid-field
                    detail: Email must be a valid email address.
        '409':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Conflict - Patient email already exists.
          content:
            application/problem+json:
              examples:
                duplicateEmail:
                  summary: Example duplicate email error (409)
                  value:
                    title: Conflict
                    status: 409
                    code: patient.email-exists
                    detail: A patient with email john.doe@example.com already exists.
        '500':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Internal Server Error.
          content:
            application/problem+json:
              examples:
                serverError:
                  summary: Example internal server error (500)
                  value:
                    title: Internal Server Error
                    status: 500
                    code: server.unexpected-error
                    detail: An unexpected error occurred while processing the request.
  /doctors:
    get:
      tags:
        - Doctors
      summary: List all doctors
      description: Retrieves a paginated list of all registered doctors.
      operationId: listDoctors
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/pageSize'
      responses:
        '200':
          $ref: '#/components/responses/DoctorList'
        '400':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Bad Request - Invalid pagination parameters.
          content:
            application/problem+json:
              examples:
                invalidPageSize:
                  summary: Example invalid page size (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.invalid-parameter
                    detail: pageSize must be an integer between 1 and 100.
        '500':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Internal Server Error.
          content:
            application/problem+json:
              examples:
                serverError:
                  summary: Example internal server error (500)
                  value:
                    title: Internal Server Error
                    status: 500
                    code: server.unexpected-error
                    detail: An unexpected error occurred while retrieving doctors.
    post:
      tags:
        - Doctors
      summary: Register a new doctor
      description: Creates a new doctor record in the system.
      operationId: registerDoctor
      requestBody:
        $ref: '#/components/requestBodies/DoctorRegistrationRequest'
      responses:
        '201':
          $ref: '#/components/responses/DoctorCreated'
        '400':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Bad Request - Invalid input data (e.g., missing fields, invalid email).
          content:
            application/problem+json:
              examples:
                validationError:
                  summary: Example validation error (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.missing-field
                    detail: Required field "specialization" is missing.
        '409':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Conflict - A doctor with the provided email already exists.
          content:
            application/problem+json:
              examples:
                duplicateEmail:
                  summary: Example duplicate email error (409)
                  value:
                    title: Conflict
                    status: 409
                    code: doctor.email-exists
                    detail: A doctor with email dr.house@example.com already exists.
        '500':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Internal Server Error.
          content:
            application/problem+json:
              examples:
                serverError:
                  summary: Example internal server error (500)
                  value:
                    title: Internal Server Error
                    status: 500
                    code: server.unexpected-error
                    detail: An unexpected error occurred while registering the doctor.
  /doctors/{doctorId}/timeslots:
    get:
      tags:
        - Doctors
      summary: Get doctor's timeslots for a specific day
      description: Retrieves a list of available and unavailable time slots for a given doctor ID and date.
      operationId: getDoctorTimeslots
      parameters:
        - $ref: '#/components/parameters/doctorId'
        - $ref: '#/components/parameters/date'
      responses:
        '200':
          $ref: '#/components/responses/DoctorTimeslots'
        '400':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Bad Request - Invalid date format.
          content:
            application/problem+json:
              examples:
                invalidDateFormat:
                  summary: Example invalid date format (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.invalid-date-format
                    detail: Date parameter must be in YYYY-MM-DD format.
                    invalid-parameter: date
        '404':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Not Found - The specified doctor ID does not exist.
          content:
            application/problem+json:
              examples:
                doctorNotFound:
                  summary: Example doctor not found (404)
                  value:
                    title: Resource Not Found
                    status: 404
                    code: doctor.not-found
                    detail: Doctor with ID b2c3d4e5-f6a7-8901-2345-67890abcdef1 not found.
                    missing-resource-id: b2c3d4e5-f6a7-8901-2345-67890abcdef1
        '500':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Internal Server Error.
          content:
            application/problem+json:
              examples:
                serverError:
                  summary: Example internal server error (500)
                  value:
                    title: Internal Server Error
                    status: 500
                    code: server.unexpected-error
                    detail: An unexpected error occurred while retrieving timeslots.
  /appointments:
    post:
      tags:
        - Appointments
      summary: Request a new appointment
      description: Allows an authenticated patient to request an appointment with a specific doctor at a given date and time slot.
      operationId: requestAppointment
      requestBody:
        $ref: '#/components/requestBodies/AppointmentRequest'
      responses:
        '201':
          $ref: '#/components/responses/AppointmentCreated'
        '400':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Bad Request - Invalid input data (e.g., missing fields, invalid format, date in past).
          content:
            application/problem+json:
              examples:
                invalidTimeFormat:
                  summary: Example invalid time format (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.invalid-time-format
                    detail: appointmentTime must be in HH:MM format.
                    invalid-field: appointmentTime
                dateInPast:
                  summary: Example date in past (400)
                  value:
                    title: Validation Error
                    status: 400
                    code: validation.date-in-past
                    detail: Appointment date cannot be in the past.
                    invalid-field: appointmentDate
        '401':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Unauthorized - Patient authentication required.
          content:
            application/problem+json:
              examples:
                unauthorized:
                  summary: Example unauthorized access (401)
                  value:
                    title: Unauthorized
                    status: 401
                    code: auth.unauthorized
                    detail: Authentication is required to request an appointment.
        '404':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Not Found - The specified doctor ID does not exist.
          content:
            application/problem+json:
              examples:
                doctorNotFound:
                  summary: Example doctor not found (404)
                  value:
                    title: Resource Not Found
                    status: 404
                    code: doctor.not-found
                    detail: Doctor with ID b2c3d4e5-f6a7-8901-2345-67890abcdef1 not found.
                    missing-resource-id: b2c3d4e5-f6a7-8901-2345-67890abcdef1
        '409':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Conflict - The requested time slot is not available or already booked by the patient.
          content:
            application/problem+json:
              examples:
                slotUnavailable:
                  summary: Example timeslot unavailable (409)
                  value:
                    title: Conflict
                    status: 409
                    code: appointment.slot-unavailable
                    detail: The requested time slot 10:00 on 2024-07-15 is no longer available.
                    conflicting-slot: 2024-07-15T10:00
                duplicateRequest:
                  summary: Example duplicate patient booking (409)
                  value:
                    title: Conflict
                    status: 409
                    code: appointment.duplicate-request
                    detail: You already have an appointment requested or scheduled at this time.
        '500':
          $ref: '#/components/responses/BaseErrorResponse'
          description: Internal Server Error.
          content:
            application/problem+json:
              examples:
                serverError:
                  summary: Example internal server error (500)
                  value:
                    title: Internal Server Error
                    status: 500
                    code: server.unexpected-error
                    detail: An unexpected error occurred while requesting the appointment.
components:
  schemas:
    Patient:
      type: object
      description: Represents a patient resource.
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: f47ac10b-58cc-4372-a567-0e02b2c3d479
        email:
          type: string
          format: email
          description: Patient's unique email address.
          example: jane.roe@example.com
        firstName:
          type: string
          description: Patient's first name.
          example: Jane
        lastName:
          type: string
          description: Patient's last name.
          example: Roe
      required:
        - id
        - email
        - firstName
        - lastName
    ErrorDetail:
      type: object
      description: Standardized error details (RFC 9457).
      properties:
        title:
          type: string
          description: Short, human-readable summary of the error type.
          example: Validation Error
        code:
          type: string
          description: Unique, machine-readable error code (e.g., 'namespace.error-name').
          example: validation.invalid-start-time
        status:
          type: integer
          format: int
          description: HTTP status code for this error occurrence.
          minimum: 100
          maximum: 599
          example: 400
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence.
          example: One or more fields submitted are invalid.
      additionalProperties: true
      required:
        - title
        - code
        - status
        - detail
    Doctor:
      type: object
      description: Data required to register a new doctor.
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: f47ac10b-58cc-4372-a567-0e02b2c3d479
        email:
          type: string
          format: email
          description: Doctor's unique email address.
          example: dr.gregory.house@example.com
        firstName:
          type: string
          description: Doctor's first name.
          minLength: 1
          example: Gregory
        lastName:
          type: string
          description: Doctor's last name.
          minLength: 1
          example: House
        specialization:
          type: string
          description: Medical specialization of the doctor.
          enum:
            - surgeon
            - gastroenterologist
            - pediatrician
            - diagnostician
            - endocrinologist
            - general_practitioner
            - cardiologist
            - dermatologist
            - neurologist
            - oncologist
            - orthopedist
            - psychiatrist
            - radiologist
            - urologist
            - other
          example: diagnostician
      required:
        - id
        - email
        - firstName
        - lastName
        - specialization
    Pagination:
      type: object
      description: Structure for paginated list responses.
      properties:
        page:
          type: integer
          format: int
          description: Current page number (0-indexed).
          example: 0
        pageSize:
          type: integer
          format: int
          description: Number of items per page.
          example: 20
        total:
          type: integer
          format: int
          description: Total number of items available.
          example: 153
      required:
        - page
        - pageSize
        - total
    TimeSlot:
      type: object
      description: Represents a single time slot for a doctor on a specific day.
      properties:
        time:
          type: string
          description: The time of the slot (HH:MM format, 24-hour clock).
          pattern: ^([01]\d|2[0-3]):([0-5]\d)$
          example: '09:30'
        status:
          type: string
          description: Indicates whether the time slot is available or not.
          enum:
            - available
            - unavailable
          example: available
      required:
        - time
        - status
    NewAppointment:
      type: object
      description: Data sent by a patient to request an appointment time slot.
      properties:
        doctorId:
          type: string
          format: uuid
          description: The unique identifier of the desired doctor.
          example: b2c3d4e5-f6a7-8901-2345-67890abcdef1
        appointmentDate:
          type: string
          format: date
          description: The requested date for the appointment (YYYY-MM-DD).
          example: '2024-07-16'
        appointmentTime:
          type: string
          description: The requested time slot (HH:MM format, 24-hour clock).
          pattern: ^([01]\d|2[0-3]):([0-5]\d)$
          example: '11:30'
        reason:
          type: string
          description: Optional reason for the appointment provided by the patient.
          example: Feeling unwell, general check-up needed.
      required:
        - doctorId
        - appointmentDate
        - appointmentTime
    AppointmentType:
      type: object
      description: Represents the type or category of an appointment.
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the appointment type.
          readOnly: true
          example: e5f6a7b8-c9d0-1234-5678-90abcdef1234
        displayName:
          type: string
          description: Human-readable name of the appointment type.
          example: Consultation
      required:
        - id
        - displayName
    PatientAppointment:
      type: object
      description: Represents an appointment from the patient's perspective.
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the appointment.
          readOnly: true
          example: d4e5f6a7-b8c9-0123-4567-890abcdef123
        appointmentDate:
          type: string
          format: date
          description: The date of the appointment.
          example: '2024-07-16'
        timeSlot:
          $ref: '#/components/schemas/TimeSlot'
        type:
          $ref: '#/components/schemas/AppointmentType'
        doctor:
          $ref: '#/components/schemas/Doctor'
        illness:
          type: string
          description: Associated illness diagnosis (if applicable).
          example: Acute Bronchitis
        status:
          type: string
          description: The current status of the appointment.
          enum:
            - requested
            - canceled
            - scheduled
            - completed
            - denied
          readOnly: true
          example: scheduled
        reason:
          type: string
          description: Reason for the appointment provided by the patient.
          example: Feeling unwell, general check-up needed.
      required:
        - id
        - appointmentDate
        - timeSlot
        - type
        - doctor
        - status
  requestBodies:
    PatientRegistration:
      description: Patient details for registration.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Patient'
    DoctorRegistrationRequest:
      description: Doctor details for registration.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Doctor'
          examples:
            newDoctor:
              summary: Example new doctor registration
              value:
                email: dr.lisa.cuddy@example.com
                firstName: Lisa
                lastName: Cuddy
                specialization: Endocrinology
    AppointmentRequest:
      description: Details for requesting a new appointment.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NewAppointment'
          examples:
            newAppointmentRequest:
              summary: Example appointment request
              value:
                doctorId: b2c3d4e5-f6a7-8901-2345-67890abcdef1
                appointmentDate: '2024-07-15'
                appointmentTime: '10:00'
                reason: Annual physical exam.
  responses:
    PatientCreated:
      description: Patient registered successfully. Returns the created patient object.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Patient'
    BaseErrorResponse:
      description: An error occurred. See specific status code for details.
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/ErrorDetail'
    DoctorList:
      description: Successfully retrieved a paginated list of doctors.
      content:
        application/json:
          schema:
            type: object
            description: A paginated list of doctors.
            properties:
              doctors:
                type: array
                description: The list of doctor objects for the current page.
                items:
                  $ref: '#/components/schemas/Doctor'
              pagination:
                $ref: '#/components/schemas/Pagination'
            required:
              - data
              - pagination
          examples:
            doctorListExample:
              summary: Example list of doctors with pagination
              value:
                doctors:
                  - id: b2c3d4e5-f6a7-8901-2345-67890abcdef1
                    email: dr.gregory.house@example.com
                    firstName: Gregory
                    lastName: House
                    specialization: DIAGNOSTICIAN
                  - id: c3d4e5f6-a7b8-9012-3456-7890abcdef12
                    email: dr.lisa.cuddy@example.com
                    firstName: Lisa
                    lastName: Cuddy
                    specialization: ENDOCRINOLOGIST
                pagination:
                  page: 0
                  pageSize: 20
                  total: 2
    DoctorCreated:
      description: Doctor registered successfully. Returns the created doctor object.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Doctor'
          examples:
            createdDoctor:
              summary: Example created doctor response
              value:
                id: c3d4e5f6-a7b8-9012-3456-7890abcdef12
                email: dr.lisa.cuddy@example.com
                firstName: Lisa
                lastName: Cuddy
                specialization: Endocrinology
    DoctorTimeslots:
      description: Successfully retrieved the list of time slots.
      content:
        application/json:
          schema:
            type: object
            properties:
              slots:
                type: array
                items:
                  $ref: '#/components/schemas/TimeSlot'
          examples:
            timeslotsExample:
              summary: Example timeslots for a doctor on a specific day
              value:
                slots:
                  - time: '09:00'
                    status: available
                  - time: '09:30'
                    status: unavailable
                  - time: '10:00'
                    status: available
                  - time: '10:30'
                    status: available
                  - time: '11:00'
                    status: unavailable
                  - time: '14:00'
                    status: available
    AppointmentCreated:
      description: Appointment requested successfully. Returns the created appointment object with 'requested' status.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PatientAppointment'
  parameters:
    page:
      name: page
      in: query
      required: false
      description: The page number to retrieve (0-indexed).
      schema:
        type: integer
        minimum: 0
        default: 0
      example: 1
    pageSize:
      name: pageSize
      in: query
      required: false
      description: The number of doctors to return per page.
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      example: 50
    doctorId:
      name: doctorId
      in: path
      required: true
      description: The unique identifier (UUID) of the doctor.
      schema:
        type: string
        format: uuid
      example: b2c3d4e5-f6a7-8901-2345-67890abcdef1
    date:
      name: date
      in: query
      required: true
      description: The specific day for which to retrieve timeslots (YYYY-MM-DD format).
      schema:
        type: string
        format: date
      example: '2024-07-15'
