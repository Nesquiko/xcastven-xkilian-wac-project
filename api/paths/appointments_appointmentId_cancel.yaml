post:
  tags:
    - Appointments
  summary: Cancel an appointment
  description: >-
    Marks an existing appointment as 'canceled'. Can be initiated by the
    patient who booked it, or by authorized staff (doctor/nurse).
    Authentication is required. An optional reason can be provided in the
    request body.
  operationId: cancelAppointment
  parameters:
    - $ref: "../components/parameters/path/appointmentId.yaml"
  requestBody:
    $ref: "../components/requestBodies/AppointmentCancellationRequest.yaml"
  responses:
    "204":
      description: Appointment successfully cancelled.

    "401":
      $ref: "../components/responses/UnauthorizedErrorResponse.yaml"

    "403":
      description: Forbidden - User does not have permission to cancel this appointment.
      content:
        application/problem+json:
          schema:
            $ref: "../components/schemas/ErrorDetail.yaml"
          examples:
            permissionDenied:
              summary: Example permission denied (403)
              value:
                title: "Forbidden"
                status: 403
                code: "auth.forbidden"
                detail: "You do not have permission to cancel this appointment."

    "404":
      description: Not Found - The specified appointment ID does not exist.
      content:
        application/problem+json:
          schema:
            $ref: "../components/schemas/ErrorDetail.yaml"
          examples:
            appointmentNotFound:
              summary: Example appointment not found (404)
              value:
                title: "Resource Not Found"
                status: 404
                code: "appointment.not-found"
                detail: "Appointment with ID d4e5f6a7-b8c9-0123-4567-890abcdef123 not found."

    "409":
      description: Conflict - The appointment cannot be cancelled (e.g., already completed or cancelled).
      content:
        application/problem+json:
          schema:
            $ref: "../components/schemas/ErrorDetail.yaml"
          examples:
            alreadyCompleted:
              summary: Example already completed (409)
              value:
                title: "Conflict"
                status: 409
                code: "appointment.invalid-state-for-cancel"
                detail: "Cannot cancel an appointment that is already completed."

    "500":
      $ref: "../components/responses/InternalServerErrorResponse.yaml"
